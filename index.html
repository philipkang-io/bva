<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postman Enterprise BVA Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        postman: {
                            DEFAULT: '#FF6C37',
                            hover: '#E05524',
                            bg: '#FFF5F0'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom range slider styling */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            background: #FF6C37;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            margin-top: -6px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            background: #ddd;
            height: 4px;
            border-radius: 2px;
        }

        /* Input Section Animation */
        .input-section {
            transition: all 0.3s ease-in-out;
            opacity: 1;
            max-height: 800px; /* Increased for larger sections */
            overflow: hidden;
        }
        .input-section.hidden-section {
            opacity: 0;
            max-height: 0;
            margin: 0;
            padding: 0;
            border: none;
        }

        /* Modal Overlay Transition */
        #formulaModal {
            transition: opacity 0.2s ease-in-out;
        }
        #formulaModal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #formulaModal:not(.hidden) {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col relative">

    <!-- Formula Modal -->
    <div id="formulaModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-gray-900 bg-opacity-75 backdrop-blur-sm">
        <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full mx-4 overflow-hidden transform transition-all scale-100">
            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-800" id="modalTitle">Calculation Logic</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <p class="text-xs text-gray-500 uppercase font-bold tracking-wider mb-2">The Formula</p>
                    <div class="bg-gray-100 p-3 rounded-md font-mono text-xs text-gray-700 break-words" id="modalFormula">
                        <!-- Formula goes here -->
                    </div>
                </div>
                <div>
                    <p class="text-xs text-gray-500 uppercase font-bold tracking-wider mb-2">Key Assumptions</p>
                    <p class="text-sm text-gray-600 leading-relaxed" id="modalDesc">
                        <!-- Description goes here -->
                    </p>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" onclick="closeModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-postman text-base font-medium text-white hover:bg-postman-hover focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-postman rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <h1 class="text-xl font-bold text-gray-900 tracking-tight">Postman <span class="text-postman">Value Calculator</span></h1>
            </div>
            <div class="text-sm text-gray-500 hidden sm:block">Sales Engineering Tool</div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Inputs (Wizard) -->
        <div class="lg:col-span-7 space-y-6">
            
            <!-- Step 1: Persona -->
            <section class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">1. Select Audience</h2>
                    <span class="px-2 py-1 bg-gray-100 text-xs font-medium text-gray-600 rounded">Dynamic Logic</span>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <label class="cursor-pointer relative">
                        <input type="checkbox" name="persona" value="platform" class="peer sr-only" onchange="calculate()">
                        <div class="p-4 rounded-lg border-2 border-gray-100 hover:border-gray-200 peer-checked:border-postman peer-checked:bg-postman-bg transition-all h-full">
                            <div class="font-medium text-gray-900 peer-checked:text-postman mb-1">Platform Eng.</div>
                            <div class="text-xs text-gray-500">Governance & Security</div>
                        </div>
                    </label>
                    <label class="cursor-pointer relative">
                        <input type="checkbox" name="persona" value="product" class="peer sr-only" onchange="calculate()">
                        <div class="p-4 rounded-lg border-2 border-gray-100 hover:border-gray-200 peer-checked:border-postman peer-checked:bg-postman-bg transition-all h-full">
                            <div class="font-medium text-gray-900 peer-checked:text-postman mb-1">Product Eng.</div>
                            <div class="text-xs text-gray-500">Velocity & Reuse</div>
                        </div>
                    </label>
                    <label class="cursor-pointer relative">
                        <input type="checkbox" name="persona" value="qe" class="peer sr-only" onchange="calculate()">
                        <div class="p-4 rounded-lg border-2 border-gray-100 hover:border-gray-200 peer-checked:border-postman peer-checked:bg-postman-bg transition-all h-full">
                            <div class="font-medium text-gray-900 peer-checked:text-postman mb-1">Head of QE</div>
                            <div class="text-xs text-gray-500">Quality & Defects</div>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Step 2: Global Variables -->
            <section class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">2. Organization Metrics</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Total Developers</label>
                        <input type="number" id="numDevs" value="50" min="1" class="w-full border-gray-300 rounded-md shadow-sm focus:border-postman focus:ring-postman" oninput="calculate()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Avg Hourly Cost ($)</label>
                        <input type="number" id="hourlyRate" value="80" min="1" class="w-full border-gray-300 rounded-md shadow-sm focus:border-postman focus:ring-postman" oninput="calculate()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">New Hires per Year</label>
                        <input type="number" id="numNewHires" value="10" min="0" class="w-full border-gray-300 rounded-md shadow-sm focus:border-postman focus:ring-postman" oninput="calculate()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Annual Releases</label>
                        <input type="number" id="annualReleases" value="24" min="1" class="w-full border-gray-300 rounded-md shadow-sm focus:border-postman focus:ring-postman" oninput="calculate()">
                    </div>
                    <!-- Hidden Seat Cost Input (Default 600) -->
                    <input type="hidden" id="seatCost" value="600">
                </div>
            </section>

            <!-- Step 3: Pain Points -->
            <section class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">3. Discovery: Pain Points</h2>
                
                <!-- 1. Productivity (Product, Platform) -->
                <div id="section-productivity" class="input-section mb-6 pb-6 border-b border-gray-100" data-audience="product,platform">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-gray-700">Hours lost per week (env setup, debugging)</label>
                        <span class="text-sm font-bold text-postman" id="prodHoursDisplay">3 hrs</span>
                    </div>
                    <input type="range" id="prodHours" min="0" max="10" step="0.5" value="3" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateRangeDisplay('prodHours', 'prodHoursDisplay', ' hrs'); calculate()">
                    <p class="text-xs text-gray-500 mt-1">Efficiency Baseline</p>
                </div>

                <!-- 2. Onboarding (Product) -->
                <div id="section-onboarding" class="input-section mb-6 pb-6 border-b border-gray-100" data-audience="product">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-gray-700">Ramp Up Time (Weeks)</label>
                        <span class="text-sm font-bold text-postman" id="rampWeeksDisplay">4 wks</span>
                    </div>
                    <input type="range" id="rampWeeks" min="1" max="12" step="1" value="4" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateRangeDisplay('rampWeeks', 'rampWeeksDisplay', ' wks'); calculate()">
                    <p class="text-xs text-gray-500 mt-1">Postman reduces ramp time by 40%</p>
                </div>

                <!-- 3. Rework/Duplication (Product) -->
                <div id="section-duplication" class="input-section mb-6 pb-6 border-b border-gray-100" data-audience="product">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-gray-700">Redundant APIs/Projects built per year</label>
                        <span class="text-sm font-bold text-postman" id="dupProjectsDisplay">1</span>
                    </div>
                    <input type="range" id="dupProjects" min="0" max="10" step="1" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateRangeDisplay('dupProjects', 'dupProjectsDisplay', ''); calculate()">
                    <p class="text-xs text-gray-500 mt-1">Cost of building redundant code</p>
                </div>

                <!-- 4. Governance (Platform) -->
                <div id="section-governance" class="input-section mb-6 pb-6 border-b border-gray-100" data-audience="platform">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-3">Governance Efficiency</h3>
                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">PRs Reviewed/Year</label>
                            <input type="number" id="prsReviewed" value="500" class="w-full text-sm border-gray-300 rounded" oninput="calculate()">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">Mins per Review</label>
                            <input type="number" id="minsReview" value="30" class="w-full text-sm border-gray-300 rounded" oninput="calculate()">
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Automating API linting & styling</p>
                </div>

                <!-- 6. Internal Integration (Platform, Product) -->
                <div id="section-integration" class="input-section mb-6 pb-6 border-b border-gray-100" data-audience="platform,product">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-3">Internal Integration Velocity</h3>
                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">Integrations/Year</label>
                            <input type="number" id="intCount" value="20" class="w-full text-sm border-gray-300 rounded" oninput="calculate()">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">Current TTFC (Hours)</label>
                            <input type="number" id="ttfcHours" value="4" class="w-full text-sm border-gray-300 rounded" oninput="calculate()">
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Time-to-First-Call reduction</p>
                </div>

                <!-- 7. Testing (QE) -->
                <div id="section-testing" class="input-section mb-6 pb-6 border-b border-gray-100" data-audience="qe">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-gray-700">Regression Cycle (Hours)</label>
                        <span class="text-sm font-bold text-postman" id="regHoursDisplay">20 hrs</span>
                    </div>
                    <input type="range" id="regHours" min="0" max="100" step="5" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateRangeDisplay('regHours', 'regHoursDisplay', ' hrs'); calculate()">
                    <p class="text-xs text-gray-500 mt-1">95% reduction via automation</p>
                </div>

                <!-- 8. Defects (QE) -->
                <div id="section-defects" class="input-section" data-audience="qe">
                    <div class="flex justify-between mb-2">
                        <label class="text-sm font-medium text-gray-700">Critical Bugs in Prod (Annual)</label>
                        <span class="text-sm font-bold text-postman" id="prodBugsDisplay">2</span>
                    </div>
                    <input type="range" id="prodBugs" min="0" max="20" step="1" value="2" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" oninput="updateRangeDisplay('prodBugs', 'prodBugsDisplay', ''); calculate()">
                    <p class="text-xs text-gray-500 mt-1">Cost of fixing in Prod vs Dev</p>
                </div>
            </section>
        </div>

        <!-- Right Column: The Money Slide (Output) -->
        <div class="lg:col-span-5">
            <div class="sticky top-24">
                <div class="bg-gray-900 text-white rounded-xl shadow-2xl overflow-hidden">
                    <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800">
                        <h3 class="font-semibold text-base">Executive Business Value Summary</h3>
                        <button onclick="copyToClipboard()" class="text-xs bg-postman hover:bg-postman-hover text-white px-3 py-1.5 rounded transition-colors flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            Copy Output
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto bg-gray-900 p-2">
                        <div id="slideContent">
                            <table border="0" cellpadding="0" cellspacing="0" style="width: 950px; min-width: 950px; background-color: #111827; color: #ffffff; font-family: sans-serif; border-collapse: collapse;">
                                <tr>
                                    <td colspan="3" style="padding: 30px; border-left: 6px solid #FF6C37; background-color: #111827;">
                                        <div style="font-size: 24px; font-weight: bold; color: white; line-height: 1.3; font-family: 'Inter', sans-serif;">
                                            "Postman Enterprise will drive <span style="color: #FF6C37;" id="outTotalSavings">$0</span> in annual efficiency gains while reducing security risk."
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <!-- Strategic Outcomes (Column 1) -->
                                    <td rowspan="2" style="width: 400px; vertical-align: top; padding: 24px 20px 40px 30px; border-right: 1px solid #374151; background-color: #111827;">
                                        <h4 style="color: #9CA3AF; font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin: 0 0 16px 0;">1. Strategic Outcomes</h4>
                                        <div style="color: #E5E7EB; font-size: 16px; line-height: 1.6;" id="strategicBullets"></div>
                                    </td>
                                    
                                    <!-- Operational Impact (Column 2 - Left) -->
                                    <td style="width: 275px; vertical-align: top; padding: 24px 10px 24px 30px; background-color: #111827;">
                                        <h4 style="color: #9CA3AF; font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin: 0 0 16px 0;">2. Operational Impact</h4>
                                        <div id="opImpactLeft"></div>
                                    </td>

                                    <!-- Operational Impact (Column 3 - Right) -->
                                    <td style="width: 275px; vertical-align: top; padding: 24px 30px 24px 10px; background-color: #111827;">
                                        <div style="height: 28px;"></div> <!-- Spacer to align with header -->
                                        <div id="opImpactRight"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <!-- ROI Summary (Spans Columns 2 & 3) -->
                                    <td colspan="2" style="padding: 0 30px 30px 30px; background-color: #111827; vertical-align: bottom;">
                                        <div style="background-color: #1F2937; padding: 20px; border-radius: 8px; border: 1px solid #374151;">
                                            <h4 style="color: #9CA3AF; font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin: 0 0 8px 0;">3. ROI Summary</h4>
                                            <p style="margin: 0; font-size: 16px; color: #E5E7EB; line-height: 1.5;">
                                                "By investing <span style="color: #ffffff; font-weight: 700;" id="outCost">$0</span>, the team creates <span style="color: #ffffff; font-weight: 700;" id="outTotalSavingsText">$0</span> in value (<span style="color: #FF6C37; font-weight: 700; font-size: 18px;" id="outROI">0x</span> ROI)."
                                            </p>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div id="toast" class="opacity-0 transition-opacity duration-300 fixed bottom-5 right-5 bg-gray-900 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Copied to clipboard!
                </div>
            </div>
        </div>
    </main>

    <script>
        const formatMoney = (amount) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(amount);
        const updateRangeDisplay = (id, display, suffix) => document.getElementById(display).innerText = document.getElementById(id).value + suffix;

        const formulaData = {
            productivity: { title: "Developer Productivity", formula: "Devs × (Hours Saved × 0.50) × 52 × Rate", desc: "50% Realization factor applied to conservative estimates." },
            onboarding: { title: "Onboarding Velocity", formula: "New Hires × (Ramp Weeks × 40%) × 40hrs × Rate", desc: "Postman reduces ramp time by 40% (Bell POV)." },
            rework: { title: "Avoided Rework", formula: "Duplicate Projects × 3 Devs × 3 Months × 160hrs × Rate", desc: "Cost of rebuilding existing but undiscoverable APIs." },
            governance: { title: "Governance Efficiency", formula: "PRs × (Mins/60) × (Rate × 1.25) × 90%", desc: "Automation saves 90% of review time. Architect rate 1.25x." },
            provisioning: { title: "IT Provisioning", formula: "New Hires × 2 Hours × (Rate × 0.75)", desc: "IT Admin rate 75% of Dev. SCIM saves 2 hrs/hire." },
            integration: { title: "Internal Integration", formula: "Integrations × (TTFC - 0.25) × Rate", desc: "Private API Network reduces TTFC to 15 mins (0.25 hrs)." },
            testing: { title: "Test Compression", formula: "Releases × Cycle Hours × 95% × Rate", desc: "95% reduction via automation (WGU Case Study)." },
            defects: { title: "Defect Remediation", formula: "Prod Defects × 100 Hours × Rate", desc: "Fixing in prod costs 100 hrs vs dev." },
            security: { title: "Risk Mitigation", formula: "$4,450,000 × 0.005", desc: "IBM Data Breach Cost ($4.45M) × 0.5% risk reduction." }
        };

        function showFormula(type) {
            const data = formulaData[type];
            if(data) {
                document.getElementById('modalTitle').innerText = data.title;
                document.getElementById('modalFormula').innerText = data.formula;
                document.getElementById('modalDesc').innerText = data.desc;
                document.getElementById('formulaModal').classList.remove('hidden');
            }
        }
        function closeModal() { document.getElementById('formulaModal').classList.add('hidden'); }
        document.getElementById('formulaModal').addEventListener('click', e => { if(e.target === document.getElementById('formulaModal')) closeModal(); });

        function calculate() {
            // Inputs
            const selectedPersonas = Array.from(document.querySelectorAll('input[name="persona"]:checked')).map(cb => cb.value);
            const isDefault = selectedPersonas.length === 0;
            
            const devs = parseInt(document.getElementById('numDevs').value) || 0;
            const rate = parseInt(document.getElementById('hourlyRate').value) || 0;
            const hires = parseInt(document.getElementById('numNewHires').value) || 0;
            const releases = parseInt(document.getElementById('annualReleases').value) || 0;
            const seatCost = parseInt(document.getElementById('seatCost').value) || 600;

            // Visibility Logic
            const mapping = {
                'section-productivity': ['product', 'platform'],
                'section-onboarding': ['product'],
                'section-duplication': ['product'],
                'section-governance': ['platform'],
                'section-integration': ['platform', 'product'],
                'section-testing': ['qe'],
                'section-defects': ['qe']
            };
            
            // Flags for Calculation
            const p = { 
                prod: false, onb: false, dup: false, gov: false, 
                prov: false, int: false, test: false, def: false, sec: false 
            };

            for (const [id, roles] of Object.entries(mapping)) {
                const visible = isDefault || roles.some(r => selectedPersonas.includes(r));
                document.getElementById(id).classList.toggle('hidden-section', !visible);
                if(visible) {
                    if(id.includes('productivity')) p.prod = true;
                    if(id.includes('onboarding')) p.onb = true;
                    if(id.includes('duplication')) p.dup = true;
                    if(id.includes('governance')) p.gov = true;
                    if(id.includes('integration')) p.int = true;
                    if(id.includes('testing')) p.test = true;
                    if(id.includes('defects')) p.def = true;
                }
            }
            // Logic for Hidden calcs (IT Provisioning & Security tied to Platform)
            if(isDefault || selectedPersonas.includes('platform')) { p.prov = true; p.sec = true; }

            // 1. Productivity
            const hoursWasted = parseFloat(document.getElementById('prodHours').value) || 0;
            const valProd = p.prod ? (devs * (hoursWasted * 0.50) * 52 * rate) : 0;

            // 2. Onboarding
            const rampWeeks = parseInt(document.getElementById('rampWeeks').value) || 0;
            const valOnb = p.onb ? (hires * (rampWeeks * 40 * 0.40) * rate) : 0;

            // 3. Rework
            const dupProj = parseInt(document.getElementById('dupProjects').value) || 0;
            const valDup = p.dup ? (dupProj * 3 * 3 * 160 * rate) : 0;

            // 4. Governance
            const prs = parseInt(document.getElementById('prsReviewed').value) || 0;
            const mins = parseInt(document.getElementById('minsReview').value) || 0;
            const valGov = p.gov ? (prs * (mins/60) * (rate * 1.25) * 0.90) : 0;

            // 5. IT Provisioning
            const valProv = p.prov ? (hires * 2 * (rate * 0.75)) : 0;

            // 6. Integration
            const intCount = parseInt(document.getElementById('intCount').value) || 0;
            const ttfc = parseFloat(document.getElementById('ttfcHours').value) || 0;
            const valInt = p.int ? (intCount * (Math.max(0, ttfc - 0.25)) * rate) : 0;

            // 7. Testing
            const regHours = parseFloat(document.getElementById('regHours').value) || 0;
            const valTest = p.test ? (releases * regHours * 0.95 * rate) : 0;

            // 8. Defects
            const prodBugs = parseInt(document.getElementById('prodBugs').value) || 0;
            const valDef = p.def ? (prodBugs * 100 * rate) : 0;

            // 9. Security
            const valSec = p.sec ? (4450000 * 0.005) : 0;

            const totalSavings = valProd + valOnb + valDup + valGov + valProv + valInt + valTest + valDef + valSec;
            const totalCost = devs * seatCost;
            const roi = totalCost > 0 ? (totalSavings / totalCost).toFixed(1) : "0";

            // Output Generation
            const bullets = document.getElementById('strategicBullets');
            bullets.innerHTML = '';
            let strats = [];
            
            if (!isDefault) {
                if(selectedPersonas.includes('platform')) {
                    strats.push("Tamed API Sprawl and Increased Efficiency");
                    strats.push("Automated Governance and Risk Reduction");
                    strats.push("Accelerated Delivery and Enhanced Productivity");
                }
                if(selectedPersonas.includes('product')) {
                    strats.push("Increase developer velocity & reuse.");
                    strats.push("Accelerate onboarding & integration time.");
                }
                if(selectedPersonas.includes('qe')) {
                    strats.push("Shift testing left to reduce production defects.");
                    strats.push("Compress regression cycles via automation.");
                }
            }
            [...new Set(strats)].forEach(t => bullets.innerHTML += `<div style="margin-bottom:12px;"><span style="color:#9CA3AF;margin-right:8px;">•</span><span style="color:#E5E7EB;">${t}</span></div>`);

            // Clear Lists
            document.getElementById('opImpactLeft').innerHTML = '';
            document.getElementById('opImpactRight').innerHTML = '';
            
            // Collect Valid Items
            let impactItems = [];
            if(valProd > 0) impactItems.push({label: "Developer Productivity", val: valProd, sub: `(Recovering ${hoursWasted} hrs/dev/wk)`, type: 'productivity'});
            if(valOnb > 0) impactItems.push({label: "Onboarding Velocity", val: valOnb, sub: "Reduced ramp time by 40%", type: 'onboarding'});
            if(valDup > 0) impactItems.push({label: "Avoided Rework", val: valDup, sub: "Eliminating redundant API builds", type: 'rework'});
            if(valGov > 0) impactItems.push({label: "Governance Efficiency", val: valGov, sub: "Automating API styling & linting", type: 'governance'});
            if(valProv > 0) impactItems.push({label: "IT Provisioning", val: valProv, sub: "Automated SCIM/SSO access", type: 'provisioning'});
            if(valInt > 0) impactItems.push({label: "Integration Velocity", val: valInt, sub: `TTFC reduced to 15 mins`, type: 'integration'});
            if(valTest > 0) impactItems.push({label: "Test Cycle Compression", val: valTest, sub: "95% reduction in regression time", type: 'testing'});
            if(valDef > 0) impactItems.push({label: "Defect Remediation", val: valDef, sub: "Cost of bugs in Prod vs Dev", type: 'defects'});
            if(valSec > 0) impactItems.push({label: "Risk Mitigation", val: valSec, sub: "Data breach risk reduction", type: 'security'});

            // Distribute Items to Columns
            if (impactItems.length === 0) {
                document.getElementById('opImpactLeft').innerHTML = '<p style="color:#6B7280;font-size:12px;">Select metrics on the left.</p>';
            } else {
                impactItems.forEach((item, index) => {
                    const html = renderItem(item);
                    // Even items to Left, Odd items to Right
                    if (index % 2 === 0) {
                        document.getElementById('opImpactLeft').innerHTML += html;
                    } else {
                        document.getElementById('opImpactRight').innerHTML += html;
                    }
                });
            }

            document.getElementById('outTotalSavings').innerText = formatMoney(totalSavings);
            document.getElementById('outTotalSavingsText').innerText = formatMoney(totalSavings);
            document.getElementById('outCost').innerText = formatMoney(totalCost);
            document.getElementById('outROI').innerText = roi + 'x';
        }

        function renderItem(item) {
            return `
                <div style="line-height: 1.4; font-family: 'Inter', sans-serif; margin-bottom: 24px;">
                    <span style="color: white; font-size: 13px; font-weight: 700;">
                        ${item.label}
                        <span class="info-icon cursor-pointer inline-block ml-1 opacity-50 hover:opacity-100" onclick="showFormula('${item.type}')" style="vertical-align:middle; cursor:pointer;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                        </span>
                    </span><br>
                    <span style="color: #FF6C37; font-family: monospace; font-size: 16px; font-weight: 700;">${formatMoney(item.val)}</span>
                    <span style="color: #9CA3AF; font-size: 11px;"> / year</span><br>
                    <span style="color: #9CA3AF; font-size: 10px; font-style: italic;">${item.sub}</span>
                </div>
            `;
        }

        function copyToClipboard() {
            const node = document.getElementById('slideContent');
            const range = document.createRange();
            range.selectNode(node);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try { document.execCommand('copy'); document.getElementById('toast').classList.remove('opacity-0'); setTimeout(()=>document.getElementById('toast').classList.add('opacity-0'),2000); } catch(e){}
            window.getSelection().removeAllRanges();
        }

        window.onload = calculate;
    </script>
</body>
</html>